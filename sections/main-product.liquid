{{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{{ 'component-accordion.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}

<link rel="stylesheet" href="{{ 'component-deferred-media.css' | asset_url }}" media="print" onload="this.media='all'">

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

{% assign product_selected = product.selected_or_first_available_variant %}

<section class="page-content product-wrapper">
     <div class="product-image-wrapper">
          {%- if product_selected.featured_media -%}
               {%- liquid
                    assign featured_media_aspect_ratio = product_selected.featured_media.aspect_ratio

                    if product_selected.featured_media.aspect_ratio == nil
                         assign featured_media_aspect_ratio = 1
                    endif
               -%}

               <div class="product-image">
                    {{ product_selected.featured_media | image_url: width: '500' | image_tag:  widths: '478 400 300 200', loading: 'lazy' }}
               </div>
          {%- else -%}
               <div class="product-image">
                    <img 
                    src="{{ 'product_placeholder.png' | asset_img_url: 'master' }}"
                    alt="Image Coming Soon" loading="lazy">
               </div>
          {%- endif -%}
     </div>
     <div class="product-info-wrapper">
          <span>some text here</span>
     </div>
     <div class="extra-details">
          <p>SsdsdsdsdsdsdadsfdfsadfsAoliD AIUYDGAIGDAIGDagDGADOIGAODGAoDIGDIBAGagFFHBIOSDHFGSFPIAehDIAHDIPUAHBDIUABDUAHSDPIGAHDPIAUWHDIAPWHDAUHDPISAHDIPAUHDPAWHDANDSAJHDAH[AOFJSE[OFHA[HDWA[QH</p>
     </div>
</section>

{% javascript %}
class ProductModal extends ModalDialog {
     constructor() {
          super();
     }

     hide() {
          super.hide();
     }

     show(opener) {
          super.show(opener);
          this.showActiveMedia();
     }

     showActiveMedia() {
          this.querySelectorAll(`[data-media-id]:not([data-media-id="${this.openedBy.getAttribute("data-media-id")}"])`).forEach((element) => {
               element.classList.remove('active');
          })
          const activeMedia = this.querySelector(`[data-media-id="${this.openedBy.getAttribute("data-media-id")}"]`);
          const activeMediaTemplate = activeMedia.querySelector('template');
          const activeMediaContent = activeMediaTemplate ? activeMediaTemplate.content : null;
          activeMedia.classList.add('active');
          activeMedia.scrollIntoView();

          const container = this.querySelector('[role="document"]');
          container.scrollLeft = (activeMedia.width - container.clientWidth) / 2;

          if (activeMedia.nodeName == 'DEFERRED-MEDIA' && activeMediaContent && activeMediaContent.querySelector('.js-youtube'))
               activeMedia.loadContent();
     }
}

customElements.define('product-modal', ProductModal);
{% endjavascript %}

<script>
     document.addEventListener('DOMContentLoaded', function () {
          function isIE() {
               const ua = window.navigator.userAgent;
               const msie = ua.indexOf('MSIE ');
               const trident = ua.indexOf('Trident/');

               return (msie > 0 || trident > 0);
          }

          if (!isIE()) return;
          const hiddenInput = document.querySelector('#{{ product_form_id }} input[name="id"]');
          const noScriptInputWrapper = document.createElement('div');
          const variantSwitcher = document.querySelector('variant-radios[data-section="{{ section.id }}"]') ||
               document.querySelector('variant-selects[data-section="{{ section.id }}"]');
          noScriptInputWrapper.innerHTML = document.querySelector(
               '.product-form__noscript-wrapper-{{ section.id }}').textContent;
          variantSwitcher.outerHTML = noScriptInputWrapper.outerHTML;

          document.querySelector('#Variants-{{ section.id }}').addEventListener('change', function (event) {
               hiddenInput.value = event.currentTarget.value;
          });
     });
</script>

{%- if first_3d_model -%}
     <script type="application/json" id="ProductJSON-{{ product.id }}">
          {
               {
                    product.media | where: 'media_type', 'model' | json
               }
          }
     </script>

     <script src="{{ 'product-model.js' | asset_url }}" defer></script>
{%- endif -%}

<script type="application/ld+json">
     {
          "@context": "http://schema.org/",
          "@type": "Product",
          "name": {
               {
                    product.title | json
               }
          },
          "url": {
               {
                    shop.url | append: product.url | json
               }
          },
          {
               % -
               if product.selected_or_first_available_variant.featured_media - %
          } {
               % -assign media_size = product.selected_or_first_available_variant.featured_media.preview_image.width |
                    append: 'x' - %
          }
          "image": [{
               {
                    product.selected_or_first_available_variant.featured_media | img_url: media_size |
                         prepend: "https:" | json
               }
          }],
          {
               % -endif - %
          }
          "description": {
               {
                    product.description | strip_html | json
               }
          },
          {
               % -
               if product.selected_or_first_available_variant.sku != blank - %
          }
          "sku": {
               {
                    product.selected_or_first_available_variant.sku | json
               }
          },
          {
               % -endif - %
          }
          "brand": {
               "@type": "Thing",
               "name": {
                    {
                         product.vendor | json
                    }
               }
          },
          "offers": [{
               % -
               for variant in product.variants - %
          } {
               "@type": "Offer",
               {
                    % -
                    if variant.sku != blank - %
               }
               "sku": {
                    {
                         variant.sku | json
                    }
               },
               {
                    % -endif - %
               }
               "availability": "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
               "price": {
                    {
                         variant.price | divided_by: 100.00 | json
                    }
               },
               "priceCurrency": {
                    {
                         cart.currency.iso_code | json
                    }
               },
               "url": {
                    {
                         shop.url | append: variant.url | json
                    }
               }
          } {
               % unless forloop.last %
          }, {
               % endunless %
          } {
               % -endfor - %
          }]
     }
</script>

{% schema %}
{
     "name": "t:sections.main-product.name",
     "tag": "section",
     "class": "product-section page-content-wrapper",
     "blocks": [
          {
               "type": "@app"
          }
     ],
     "settings": [
          {
               "type": "checkbox",
               "id": "enable_sticky_info",
               "default": true,
               "label": "t:sections.main-product.settings.enable_sticky_info.label"
          },
          {
               "type": "header",
               "content": "t:sections.main-product.settings.header.content",
               "info": "t:sections.main-product.settings.header.info"
          },
          {
               "type": "checkbox",
               "id": "hide_variants",
               "default": false,
               "label": "t:sections.main-product.settings.hide_variants.label"
          },
          {
               "type": "checkbox",
               "id": "enable_video_looping",
               "default": false,
               "label": "t:sections.main-product.settings.enable_video_looping.label"
          }
     ]
}
{% endschema %}